<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>movie</title>
      <script src= 'http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
      <!-- Bootstrap Core CSS -->
        {% load static %}
        <link rel="stylesheet" href="{% static 'movies_app/css/stylesheet.css' %}">
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
    <script>
      var api_key = 'sszbbjhadk82fc9nh469bs2k';
      var baseUrl = "http://data.tmsapi.com/v1.1";
      var base_img_url = "http://developer.tmsimg.com/";
      var showtimesUrl = baseUrl + '/movies/'+ {{movie_id}} +'/showings';
      var zipCode = {{current}};
      var d = new Date();//{{request.session.date}};  //i need this to be in a session storing the data from the date field
      var today = d.getFullYear() + '-' + (d.getMonth()+1) + '-' + d.getDate();
      $(document).ready(function(){
        $.ajax({
          url: showtimesUrl,
            data: { startDate: today,
              zip: zipCode,
              jsonp: "dataHandler",
              api_key: api_key
              },
            dataType: "jsonp",
          });
        });
        function dataHandler(data) {
          console.log('<p>Found ' + data.length + ' movies showing within 5 miles of ' + zipCode+':</p>')
          $.each(data, function(index, movie) {
            for (var i = 0; i < movie.showtimes.length; i++) {
            $('.poster').html('<img src = "' + base_img_url + movie.preferredImage.uri +'?api_key='+api_key+'">');
            $('.desc').html('<p>'+movie.shortDescription+'</p>')
            $('.rating').html('<h1>'+ movie.ratings[0].code +'</h1>')
              $('.showtimes').append("<form class='shows' action='/watch/"+{{movie_id}}+"' method='post'>{% csrf_token %}<input type='hidden' name='showtime' value="+movie.showtimes[0].dateTime+"><input type='hidden' name='movieid' value="+{{movie_id}}+"><input class="+i+" type='submit' name='submit' value="+ movie.showtimes[0].dateTime +"></form>");
              $(document).on('click')
              $('.'+i).submit(function() {
                $('.showtimes').html('<p> Congradulations on picking '+movie.showtimes[0].dateTime.toString()+'! '+{{count}}+' people are going with you. Tell your friends to find you and add themselves to this movie.</p>');
              })
            }
          })
        }
  </script>
<style>
    h1{
      color: white;
      font-size: 24px;
     font-family: "Times New Roman", Times, serif;
    }

    h2{
      font-family: "Times New Roman", Times, serif;
    }

    p{
      text-align: center;
      color: white;
      font-size: 20px;
    }
  

    input[type="submit"]{
      padding: 5px 10px;
      display: inline;
      color: blue;
    }
  </style>
  </head>
  <body>


<div class="wrapper" id= 'selection'>
    <h2 class="subhead">Your Selection</h2>
    <hr>
    <!-- <p>{{movie_id}}</p> -->
    <div class="poster">
    </div>
    <div class="rating">

    </div>
    <div class="desc">

    </div>
    <div class="showtimes" id= "time">

    </div>
  </div>
  </body>
</html>
